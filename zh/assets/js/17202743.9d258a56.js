"use strict";(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[1735],{3905:(e,t,o)=>{o.d(t,{Zo:()=>h,kt:()=>p});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},h=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),m=c(o),u=a,p=m["".concat(s,".").concat(u)]||m[u]||d[u]||i;return o?n.createElement(p,r(r({ref:t},h),{},{components:o})):n.createElement(p,r({ref:t},h))}));function p(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=o.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:a,r[1]=l;for(var c=2;c<i;c++)r[c]=o[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},5107:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=o(7462),a=(o(7294),o(3905));const i={title:"Mempool",slug:"/mempool"},r=void 0,l={unversionedId:"architecture/mempool",id:"architecture/mempool",title:"Mempool",description:"The mempool (or memory pool) is a collection of transactions stored by full nodes, usually in memory, before they are confirmed on the blockchain. The mempool is not dictated by the consensus rules; a farmer can change how their mempool functions and customize the rules without permission from other full nodes.",source:"@site/docs/architecture/mempool.md",sourceDirName:"architecture",slug:"/mempool",permalink:"/zh/mempool",draft:!1,editUrl:"https://github.com/Chia-Network/chia-docs/blob/main/docs/architecture/mempool.md",tags:[],version:"current",frontMatter:{title:"Mempool",slug:"/mempool"},sidebar:"tutorialSidebar",previous:{title:"Wallets",permalink:"/zh/wallet-architecture"},next:{title:"Consensus Introduction",permalink:"/zh/consensus-intro"}},s={},c=[{value:"Validation",id:"validation",level:2},{value:"Fee Required for Inclusion",id:"fee-required-for-inclusion",level:2},{value:"Scenario 1: Mempool Not Busy",id:"scenario-1-mempool-not-busy",level:3},{value:"Scenario 2: Mempool Busy But Not Full",id:"scenario-2-mempool-busy-but-not-full",level:3},{value:"Scenario 3: Mempool Full",id:"scenario-3-mempool-full",level:3},{value:"Replace by Fee",id:"replace-by-fee",level:2},{value:"Block Creation",id:"block-creation",level:2},{value:"Updating the Mempool",id:"updating-the-mempool",level:2}],h={toc:c},m="wrapper";function d(e){let{components:t,...o}=e;return(0,a.kt)(m,(0,n.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The mempool (or memory pool) is a collection of transactions stored by full nodes, usually in memory, before they are confirmed on the blockchain. The mempool is not dictated by the consensus rules; a farmer can change how their mempool functions and customize the rules without permission from other full nodes."),(0,a.kt)("p",null,"The mempool is a required facet of Chia due to the decentralized nature of the blockchain. Transaction blocks occur approximately every 52 seconds, and it's impossible to predict who will win a block. Therefore, all transactions must be broadcast to the whole network and stored locally until they are confirmed. Additionally, it is normal to have more pending transactions than can fit in a single block, so the mempool also acts as a queue for inclusion into the blockchain."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},'How many transactions can fit into a block? Due to the varying size of transactions, and the different definitions of what even counts as a "transaction," there is not an exact number. But just for a bit of rough guidance, approximately 1000 transactions with two inputs and two outputs, or 2000 transactions with one input and one output can fit into a single block.')),(0,a.kt)("p",null,"When a user makes a transaction, it gets sent to a full node, which then verifies it, adds it to the mempool, and broadcasts it to all of its peers. Therefore, transactions get propagated to the whole network in a very short period of time."),(0,a.kt)("h2",{id:"validation"},"Validation"),(0,a.kt)("p",null,"Only valid transactions are allowed to enter the mempool. The process of validating transactions is similar to the process of validating blocks. This includes running CLVM, checking conditions, validating signatures, and checking that the coins to be spent are currently unspent and valid."),(0,a.kt)("p",null,"The transaction is also checked against other transactions in the mempool, to ensure there are no conflicts."),(0,a.kt)("h2",{id:"fee-required-for-inclusion"},"Fee Required for Inclusion"),(0,a.kt)("p",null,"When you submit a transaction, one of several possible scenarios will play out, depending on how full the mempool is, how large of a fee was included, the CLVM cost of the transaction, and other factors. Keep in mind that each farmer has its own copy of the mempool, with its own set of rules. The default mempool behavior discussed in this section will apply to most, but not all, nodes. It is up to each individual farmer to decide which transactions to include upon creating a block."),(0,a.kt)("p",null,"To view the current status of the mempool, see the dashboard for ",(0,a.kt)("a",{parentName:"p",href:"https://dashboard.chia.net/d/46EAA05E/mempool-transactions-and-fees?orgId=1&var-network=mainnet"},"mainnet")," and ",(0,a.kt)("a",{parentName:"p",href:"https://dashboard.chia.net/d/46EAA05E/mempool-transactions-and-fees?orgId=1&var-network=testnet10"},"testnet10"),"."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Currently, the block size is artificially limited to 50% of its capacity. Eventually this limitation will be lifted, but the numbers discussed in this section assume it is being enforced.")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"The total size of the mempool differs by network."),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Mainnet: 550 billion cost, or 100 blocks"),(0,a.kt)("li",{parentName:"ul"},"Testnet10: 110 billion cost, or 20 blocks"))),(0,a.kt)("h3",{id:"scenario-1-mempool-not-busy"},"Scenario 1: Mempool Not Busy"),(0,a.kt)("p",null,"If the transaction you just submitted -- plus the entire contents of the mempool -- can fit into one block, then your transaction will be added to the next block. This is true even if you don't include a transaction fee."),(0,a.kt)("p",null,"The reason for this is straightforward -- the farmer has nothing to gain by excluding certain transactions, so it will include everything. Note that some proprietary software takes the opposite approach: the farmer will ",(0,a.kt)("em",{parentName:"p"},"only")," include transactions that pay a fee, regardless of mempool size."),(0,a.kt)("p",null,"The mempool for Chia's mainnet is often in this state. This does not mean that no transactions are being submitted. It simply means that the network's speed of around 20 transactions per second is sufficient to keep up with demand."),(0,a.kt)("h3",{id:"scenario-2-mempool-busy-but-not-full"},"Scenario 2: Mempool Busy But Not Full"),(0,a.kt)("p",null,"If the mempool's contents will occupy more than one block, but the mempool is not full, then it is considered ",(0,a.kt)("em",{parentName:"p"},"busy"),". In this case:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Transactions that don't include fees will be added to the mempool, but they won't make it into the next block. Instead, they will have to \"wait in line\" for higher-priority transactions to be cleared. They likely will eventually be included in a block, but this is not guaranteed."),(0,a.kt)("li",{parentName:"ul"},"Transactions with fees will be added to the mempool and prioritized according to the size of their fee-per-cost. For example, a transaction with a 1-mojo fee will enter the queue ahead of zero-fee transactions. ")),(0,a.kt)("admonition",{title:"Testnet10 info",type:"info"},(0,a.kt)("p",{parentName:"admonition"},'Testnet10 is constantly being "dusted" (thousands of small transactions are being included) in order to simulate a busy network, which can be useful for testing. The dust transactions do not include any fees, so in order for your transaction to be prioritized ahead of the dust, you simply have to include a 1-mojo fee. In this case, your transaction will likely be included in the next transaction block. However, if you don\'t include a fee, it will likely need to wait ~40-60 minutes before being included.')),(0,a.kt)("h3",{id:"scenario-3-mempool-full"},"Scenario 3: Mempool Full"),(0,a.kt)("p",null,"If the mempool is completely full, then in order for your transaction to be added, it will need to kick out one or more transactions. In this scenario:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Transactions with no fee will not be added to the mempool."),(0,a.kt)("li",{parentName:"ul"},"Transactions with a fee of less than five mojos per cost (~100 million mojos for 2-input, 2-output transactions) will be treated as zero-fee transactions, i.e. they will not be added to the mempool."),(0,a.kt)("li",{parentName:"ul"},"Transactions with a fee of at least five mojos per cost will be added to the mempool, prioritized by fee-per-cost, ",(0,a.kt)("em",{parentName:"li"},"if")," they are not the lowest priority transactions. In this case, one or more of the lowest-priority transactions will be removed."),(0,a.kt)("li",{parentName:"ul"},"If the lowest-cost transaction in the mempool is higher than than the new transaction, then the new transaction will not be added. For example, if the lowest priority transaction in the mempool has a fee of 100 mojos-per-cost (as might be the case in a very busy network), then a new transaction will have to include a higher fee in order to be added to the mempool.")),(0,a.kt)("p",null,"This scenario often occurs on testnet10. When the mempool is completely full, the dusters stop submitting transactions until some of the dust has been cleared. This scenario might occasionally happen on mainnet as well, in which case a minimum fee would be required."),(0,a.kt)("p",null,"If you see ",(0,a.kt)("inlineCode",{parentName:"p"},"INVALID_FEE_TOO_CLOSE_TO_ZERO")," in your log file, the mempool was likely full when you submitted your transaction, and you did not include a sufficient fee to kick out an existing transaction. Try resubmitting your transaction with a higher fee."),(0,a.kt)("h2",{id:"replace-by-fee"},"Replace by Fee"),(0,a.kt)("p",null,"A transaction can replace another transaction in the mempool if it spends at least the same coins as the original one."),(0,a.kt)("p",null,"For example, if the original transaction spent coins A and B, then another transaction that spends A, B, and C can replace it. However, a transaction that spends B and C cannot. This prevents denial-of-service (DOS) attacks, as well as censorship of transactions. There is also a minimum fee bump which might depend on mempool software being used. In ",(0,a.kt)("inlineCode",{parentName:"p"},"chia-blockchain"),", this is set to 5 fee-per-cost. This prevents spam replacement transactions."),(0,a.kt)("h2",{id:"block-creation"},"Block Creation"),(0,a.kt)("p",null,"When the farmer makes a block, they will select the highest fee-per-cost transactions from the mempool until they reach the maximum block size. These spend bundles are combined into one large spend bundle, which is guaranteed to be valid,\nsince all spend bundles in the mempool must spend disjointed coins."),(0,a.kt)("p",null,"Coin spends cannot impact other coin spends, which is a very nice property of UTXO systems, and allows parallelization of validation and block creation. The aggregate\nspend bundle also has one aggregate signature, which is a combination of every signature from every transaction in that block."),(0,a.kt)("p",null,'For performance reasons, the chia-blockchain codebase currently creates only smaller blocks (less than 50% of the maximum size) in order to keep the blockchain smaller and easier to run. This "throttle" is likely to be removed in future versions, after additional optimizations have been performed.'),(0,a.kt)("h2",{id:"updating-the-mempool"},"Updating the Mempool"),(0,a.kt)("p",null,"After a new block is added to the blockchain, all full nodes must look at the coins that were spent in that new block, and remove them from the mempool. The full node does not need to reapply every transaction again, since Chia coin spends are deterministic and sandboxed (see the ",(0,a.kt)("a",{parentName:"p",href:"/coin-set-intro"},"Coin Set Intro page")," for more information). The full node only needs to look at the spent coins in the new block, and if there are any transactions that spend one of those coins, they are removed from the mempool. This means the mempool can be very large, the codebase can be simple, and high performance can be achieved."))}d.isMDXComponent=!0}}]);