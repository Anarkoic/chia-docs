"use strict";(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[4288],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(n),m=i,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var d=2;d<r;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},737:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=n(7462),i=(n(7294),n(3905));const r={slug:"/conditions",title:"Conditions"},o=void 0,l={unversionedId:"coin-set-model/conditions",id:"coin-set-model/conditions",title:"Conditions",description:"When a coin is spent, its puzzle is executed on the Chialisp Virtual Machine (CLVM). If the program does not fail, it returns a list of conditions. These conditions determine what the outcome of the spend is, and whether or not the spend is valid.",source:"@site/docs/coin-set-model/conditions.md",sourceDirName:"coin-set-model",slug:"/conditions",permalink:"/conditions",draft:!1,editUrl:"https://github.com/Chia-Network/chia-docs/blob/main/docs/coin-set-model/conditions.md",tags:[],version:"current",frontMatter:{slug:"/conditions",title:"Conditions"},sidebar:"tutorialSidebar",previous:{title:"Costs",permalink:"/coin-set-costs"},next:{title:"Spend Bundles",permalink:"/spend-bundles"}},s={},d=[{value:"Condition List",id:"list",level:2},{value:"Condition Costs",id:"costs",level:2},{value:"Hinting",id:"hinting",level:2},{value:"Announcements",id:"announcements",level:2}],p={toc:d},u="wrapper";function c(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"When a coin is spent, its puzzle is executed on the Chialisp Virtual Machine (CLVM). If the program does not fail, it returns a list of conditions. These conditions determine what the outcome of the spend is, and whether or not the spend is valid."),(0,i.kt)("p",null,"Puzzles have no access to the outside world, or even to blockchain parameters like block height. Therefore, to interact with the outside environment, they return a list of conditions, each of which must be valid in order for the spend itself to be valid."),(0,i.kt)("p",null,"There are two kinds of conditions. Some require something to be true (such as time passing) in order for the spend to be valid. And others cause something to happen if the spend is valid (such as the creation of new coins)."),(0,i.kt)("h2",{id:"list"},"Condition List"),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Be vigilant when using ",(0,i.kt)("inlineCode",{parentName:"p"},"ASSERT_MY_COIN_ID")," as a shortcut for validating the parent coin id, puzzle hash, and amount. If they are passed into the solution separately, then validated all at once by hashing them together, it is possible to shift the bytes to the left or right and manipulate the values."),(0,i.kt)("p",{parentName:"admonition"},"Consider either checking them individually or verifying that the hashes are indeed 32 bytes in length.")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"ASSERT_COIN_ANNOUNCEMENT")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ASSERT_PUZZLE_ANNOUNCEMENT")," should only be used in a puzzle's ",(0,i.kt)("em",{parentName:"p"},"solution"),", and not in the puzzle itself.\nThis is especially important when using the ",(0,i.kt)("inlineCode",{parentName:"p"},"ASSERT_COIN_ANNOUNCEMENT")," condition because it refers to a specific coin. "),(0,i.kt)("p",{parentName:"admonition"},"To illustrate the danger, let's say ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A")," uses this condition in its puzzle, and it asserts a coin announcement from ",(0,i.kt)("inlineCode",{parentName:"p"},"coin B"),".\nIn this case, ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A")," requires ",(0,i.kt)("inlineCode",{parentName:"p"},"coin B")," to be spent in the same block as it is spent.\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"coin B")," is spent before ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A"),", then ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A")," can ",(0,i.kt)("em",{parentName:"p"},"never")," be spent."),(0,i.kt)("p",{parentName:"admonition"},"However, if this condition is instead used in the ",(0,i.kt)("em",{parentName:"p"},"solution")," for ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"coin B")," has already been spent, then ",(0,i.kt)("inlineCode",{parentName:"p"},"coin A")," can still be spent later, albeit with a different solution."),(0,i.kt)("p",{parentName:"admonition"},"It is somewhat less dangerous to use ",(0,i.kt)("inlineCode",{parentName:"p"},"ASSERT_PUZZLE_ANNOUNCEMENT")," in a coin's puzzle because it only relies on a coin with a specific puzzle, and many such coins might exist.\nHowever, it is still best practice to only use this condition in a coin's solution.")),(0,i.kt)("p",null,"This is an extensive list of each condition allowed on the Chia blockchain."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Condition"),(0,i.kt)("th",{parentName:"tr",align:null},"Format"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"REMARK"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(1)")),(0,i.kt)("td",{parentName:"tr",align:null},"Always valid. Can be used to pass data to outer puzzles.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"AGG_SIG_UNSAFE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(49 public_key message)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires a signature for the message. Prefer ",(0,i.kt)("inlineCode",{parentName:"td"},"AGG_SIG_ME"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"AGG_SIG_ME"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(50 public_key message)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires a signature for the message specific to this coin.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"CREATE_COIN"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(51 puzzle_hash amount (memos))")),(0,i.kt)("td",{parentName:"tr",align:null},"Creates a new coin. The memo field is optional.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"RESERVE_FEE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(52 amount)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires a fee of at least the amount given.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"CREATE_COIN_ANNOUNCEMENT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(60 message)")),(0,i.kt)("td",{parentName:"tr",align:null},"Creates a block announcement specific to this coin.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_COIN_ANNOUNCEMENT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(61 announcement_id)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires a coin specific block announcement by its id. (see above warning)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"CREATE_PUZZLE_ANNOUNCEMENT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(62 message)")),(0,i.kt)("td",{parentName:"tr",align:null},"Creates a block announcement specific to this puzzle.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_PUZZLE_ANNOUNCEMENT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(63 announcement_id)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires a puzzle specific block announcement by its id. (see above warning)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_MY_COIN_ID"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(70 coin_id)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the coin id match a value.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_MY_PARENT_ID"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(71 parent_id)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the parent coin id match a value.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_MY_PUZZLEHASH"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(72 puzzle_hash)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the puzzle hash match a value.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_MY_AMOUNT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(73 amount)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the amount match a value.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_SECONDS_RELATIVE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(80 seconds_passed)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires at least ",(0,i.kt)("inlineCode",{parentName:"td"},"seconds_passed")," seconds to have passed since this coin's creation.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_SECONDS_ABSOLUTE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(81 seconds)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the current block's timestamp to be at least ",(0,i.kt)("inlineCode",{parentName:"td"},"seconds"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_HEIGHT_RELATIVE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(82 block_height_passed)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires more than ",(0,i.kt)("inlineCode",{parentName:"td"},"block_height_passed")," blocks to have passed since this coin's creation.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ASSERT_HEIGHT_ABSOLUTE"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"(83 block_height)")),(0,i.kt)("td",{parentName:"tr",align:null},"Requires the current block's height to be at least ",(0,i.kt)("inlineCode",{parentName:"td"},"block_height"),".")))),(0,i.kt)("h2",{id:"costs"},"Condition Costs"),(0,i.kt)("p",null,"Conditions not listed here do not have a cost associated with them."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Condition"),(0,i.kt)("th",{parentName:"tr",align:null},"Cost"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"CREATE_COIN"),(0,i.kt)("td",{parentName:"tr",align:null},"1800000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"AGG_SIG_UNSAFE"),(0,i.kt)("td",{parentName:"tr",align:null},"1200000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"AGG_SIG_ME"),(0,i.kt)("td",{parentName:"tr",align:null},"1200000")))),(0,i.kt)("h2",{id:"hinting"},"Hinting"),(0,i.kt)("p",null,"A hint is another word for memo. It's an extra value linked to coins that gets indexed by full nodes. Given a hint, a wallet can discover all coins which include that hint. Additionally, once a wallet has found a coin that includes a hint, it will have another piece of information to determine how it should be spent."),(0,i.kt)("p",null,"Typically, a hint is the coin's inner puzzle hash. When a wallet sees a hint, it fetches the parent coin spend and attempts to use the hint to figure out the coin's type. For example, if the coin is a CAT, the wallet can determine the CAT's TAIL, and therefore its type, without additional input from an end user."),(0,i.kt)("p",null,"Thus, hints are powerful because they enable wallets to auto-discover CATs and NFTs associated with that wallet. If hints didn't exist, end users would have to tell their wallets which CATs or NFTs to look for. In the case of an airdrop, if there were no hinting, the wallet's owner might not even know about an asset, so it would never be discovered."),(0,i.kt)("p",null,"When creating a coin, you can pass it a list of 32 byte hints. This field is optional, and will be ignored if missing or invalid."),(0,i.kt)("p",null,"Currently, only one hint is used and the rest are completely ignored, but in the future multiple may be used for something."),(0,i.kt)("h2",{id:"announcements"},"Announcements"),(0,i.kt)("p",null,"Announcements are ephemeral, meaning that they don't last forever. They are only accessible within the block they are created. Their purpose is to allow interaction between coins. You can require that one spend happen in order for another to happen, and vice versa."),(0,i.kt)("p",null,"For coin announcements, the id is the coin id and message sha256 hashed together. Likewise, for puzzle announcements, it's the puzzle hash and message sha256 hashed together."))}c.isMDXComponent=!0}}]);